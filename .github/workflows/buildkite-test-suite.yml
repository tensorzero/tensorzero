name: Buildkite Test Suite
run-name: "Buildkite Test Suite: ${{ github.event.pull_request.title || github.ref }}"

on:
  merge_group:
  pull_request:
    branches: ["main"]

jobs:
  unit-tests:
    # Run for non-PR events, or PRs where the head repo is the same as this repo (not a fork).
    if: ${{ github.event_name != 'pull_request' || github.event.pull_request.head.repo.full_name == github.repository }}
    runs-on: ubuntu-latest
    steps:
      - name: Trigger a Buildkite Build on Push using v2.0.0
        uses: buildkite/trigger-pipeline-action@v2.0.0
        with:
          buildkite_api_access_token: ${{ secrets.TRIGGER_BK_BUILD_TOKEN }}
          pipeline: "tensorzero/pr-tests"
