name: Slash Command Dispatch

permissions:
  pull-requests: write  # For doing the emoji reaction on a PR comment
  issues: write  # For doing the emoji reaction on an issue comment
  contents: write  # For executing the repository_dispatch event

on:
  issue_comment:
    types: [created]
  workflow_dispatch:
jobs:
  slashCommandDispatch:
    runs-on: ubuntu-latest
    steps:
      - name: "Check permission"
        id: check-permission
        run: |
          PERM=$(gh api repos/tensorzero/tensorzero/collaborators/${{ github.actor }}/permission | jq .permission -r)
          echo "ACTOR_PERM=$PERM" >> $GITHUB_OUTPUT
      - name: Slash Command Dispatch
        if: ${{ steps.check-permission.outputs.ACTOR_PERM && steps.check-permission.outputs.ACTOR_PERM != 'read' }}
        uses: peter-evans/slash-command-dispatch@13bc09769d122a64f75aa5037256f6f2d78be8c4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commands: |
            regen-fixtures
          # Use our custom permission check above, since `peter-evans/slash-command-dispatch` doesn't handle organizations 
          permission: none