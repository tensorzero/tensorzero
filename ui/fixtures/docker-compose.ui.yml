services:
  ui:
    image: tensorzero/ui:${TENSORZERO_UI_TAG:-latest}
    build:
      context: ../..
      dockerfile: ui/Dockerfile
    environment:
      - TENSORZERO_GATEWAY_URL=${TENSORZERO_GATEWAY_URL:-http://gateway:3000}
      - TENSORZERO_CLICKHOUSE_URL=http://chuser:chpassword@clickhouse:8123/tensorzero_ui_fixtures
      # Allow overriding these from environment variables
      - OPENAI_BASE_URL
      - FIREWORKS_BASE_URL
      - FIREWORKS_ACCOUNT_ID
      - TOGETHER_BASE_URL
      - VITE_TENSORZERO_FORCE_CACHE_ON
    volumes:
      - ./config:/app/config:ro
    env_file:
      - .env
    ports:
      - "4000:4000"
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"
    depends_on:
      clickhouse:
        condition: service_healthy
      postgres:
        condition: service_healthy
      gateway-postgres-migrations:
        condition: service_healthy
