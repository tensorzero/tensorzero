# ┌────────────────────────────────────────────────────────────────────────────┐
# │                                   MODELS                                   │
# └────────────────────────────────────────────────────────────────────────────┘

[models."gpt-4o-mini-2024-07-18"]
routing = ["openai"]

[models."gpt-4o-mini-2024-07-18".providers.openai]
type = "openai"
model_name = "gpt-4o-mini-2024-07-18"

[models."llama-3.1-8b-instruct"]
routing = ["fireworks"]

[models."llama-3.1-8b-instruct".providers.fireworks]
type = "fireworks"
model_name = "accounts/fireworks/models/llama-v3p1-8b-instruct"

[embedding_models.text-embedding-3-small]
routing = ["openai"]

[embedding_models.text-embedding-3-small.providers.openai]
type = "openai"
model_name = "text-embedding-3-small"

[models."ft:gpt-4o-mini-2024-07-18:tensorzero::ALHEaw1j"]
routing = ["openai"]

[models."ft:gpt-4o-mini-2024-07-18:tensorzero::ALHEaw1j".providers.openai]
type = "openai"
model_name = "ft:gpt-4o-mini-2024-07-18:tensorzero::ALHEaw1j"

# ┌────────────────────────────────────────────────────────────────────────────┐
# │                                 FUNCTIONS                                  │
# └────────────────────────────────────────────────────────────────────────────┘

[functions.extract_entities]
type = "json"
output_schema = "functions/extract_entities/output_schema.json"

[functions.extract_entities.variants.gpt4o_mini_initial_prompt]
type = "chat_completion"
model = "gpt-4o-mini-2024-07-18"
system_template = "functions/extract_entities/initial_prompt/system_template.minijinja"

[functions.extract_entities.variants.gpt4o_initial_prompt]
type = "chat_completion"
model = "openai::gpt-4o"
system_template = "functions/extract_entities/initial_prompt/system_template.minijinja"

[functions.extract_entities.variants.llama_8b_initial_prompt]
type = "chat_completion"
model = "llama-3.1-8b-instruct"
system_template = "functions/extract_entities/initial_prompt/system_template.minijinja"

[functions.extract_entities.variants.baseline]
type = "chat_completion"
model = "gpt-4o-mini-2024-07-18"
system_template = "functions/extract_entities/baseline/system_template.minijinja"
json_mode = "strict"

[functions.extract_entities.variants.dicl]
type = "experimental_dynamic_in_context_learning"
embedding_model = "text-embedding-3-small"
model = "gpt-4o-mini-2024-07-18"
k = 10
system_instructions = "functions/extract_entities/baseline/system_template.minijinja"
json_mode = "strict"
weight = 1

[functions.extract_entities.variants.turbo]
type = "chat_completion"
model = "ft:gpt-4o-mini-2024-07-18:tensorzero::ALHEaw1j"
system_template = "functions/extract_entities/baseline/system_template.minijinja"

[functions.write_haiku]
type = "chat"
user_schema = "functions/write_haiku/user_schema.json"

[functions.write_haiku.variants.initial_prompt_gpt4o_mini]
type = "chat_completion"
model = "gpt-4o-mini-2024-07-18"
system_template = "functions/write_haiku/initial_prompt/system_template.minijinja"
user_template = "functions/write_haiku/initial_prompt/user_template.minijinja"

[functions.generate_secret]
type = "json"
output_schema = "functions/generate_secret/output_schema.json"

[functions.generate_secret.variants.baseline]
weight = 1
type = "chat_completion"
model = "openai::gpt-4o-mini-2024-07-18"
system_template = "functions/generate_secret/baseline/system_template.minijinja"
json_mode = "strict"
# for creativity
temperature = 1.5

[functions.ask_question]
type = "json"
output_schema = "functions/ask_question/output_schema.json"
system_schema = "functions/ask_question/system_schema.json"

[functions.ask_question.variants.baseline]
type = "chat_completion"
weight = 1
model = "openai::gpt-4o-mini-2024-07-18"
system_template = "functions/ask_question/baseline/system_template.minijinja"

[functions.answer_question]
type = "chat"
system_schema = "functions/answer_question/system_schema.json"

[functions.answer_question.variants.baseline]
type = "chat_completion"
weight = 1
model = "openai::gpt-4o-mini-2024-07-18"
system_template = "functions/answer_question/baseline/system_template.minijinja"
# for honesty
temperature = 0.5

# ┌────────────────────────────────────────────────────────────────────────────┐
# │                                  METRICS                                   │
# └────────────────────────────────────────────────────────────────────────────┘

[metrics.exact_match]
type = "boolean"
level = "inference"
optimize = "max"

[metrics.exact_match_episode]
type = "boolean"
level = "episode"
optimize = "max"

[metrics.jaccard_similarity]
type = "float"
level = "inference"
optimize = "max"

[metrics.jaccard_similarity_episode]
type = "float"
level = "episode"
optimize = "max"

[metrics.haiku_score]
type = "boolean"
level = "inference"
optimize = "max"

[metrics.haiku_score_episode]
type = "boolean"
level = "episode"
optimize = "max"

[metrics.haiku_rating]
type = "float"
level = "inference"
optimize = "max"

[metrics.haiku_rating_episode]
type = "float"
level = "episode"
optimize = "max"

[metrics.solved]
type = "boolean"
level = "episode"
optimize = "max"

[metrics.num_questions]
type = "float"
level = "episode"
optimize = "min"
