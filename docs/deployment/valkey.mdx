---
title: Deploy Valkey (optional)
description: Learn how to deploy Valkey for high-performance rate limiting in TensorZero.
---

<Note>

**Most TensorZero deployments will not require Valkey.**

</Note>

[Valkey](https://valkey.io/) is an open-source in-memory data store forked from Redis, and it can support rate limiting at sub-millisecond p95 latency for over 10K QPS with our implementation.

TensorZero does not require Valkey, but for [custom rate limits](/operations/enforce-custom-rate-limits) in deployments with high throughput, we recommend deployment Valkey as the backend for rate limiting.

<Tip>

You can also use [Postgres](/deployment/postgres) for rate limiting if you don't need to support high QPS or already have Postgres deployed.

</Tip>


<Note>

If `TENSORZERO_VALKEY_URL` is set, TensorZero uses Valkey for rate limiting regardless of Postgres availability.

</Note>


## Deploy

You can self-host Valkey or use a managed Redis-compatible service (e.g. AWS ElastiCache, GCP Memorystore).

<Tabs>

<Tab title="Docker Compose">

Add Valkey to your `docker-compose.yml`:

```yaml title="docker-compose.yml"
services:
  valkey:
    image: valkey/valkey:8
    ports:
      - "6379:6379"
    volumes:
      - valkey-data:/data

volumes:
  valkey-data:
```

</Tab>

<Tab title="Docker">

Run Valkey with Docker:

```bash
docker run -d --name valkey -p 6379:6379 valkey/valkey:8
```

</Tab>

</Tabs>

<Note>

If you find any compatibility issues, please open a detailed [GitHub Discussion](https://github.com/tensorzero/tensorzero/discussions/new?category=bug-reports).

</Note>

## Configure

To configure TensorZero to use Valkey, set the `TENSORZERO_VALKEY_URL` environment variable with your Valkey connection details.

```bash title=".env"
TENSORZERO_VALKEY_URL="redis://[hostname]:[port]"

# Example:
TENSORZERO_VALKEY_URL="redis://localhost:6379"
```

TensorZero automatically loads the required Lua functions into Valkey on startup. No manual setup is required.

## Durability

A critical failure of Valkey (e.g. crash or power outage) could mean losing rate limiting data since the last backup. When the rate limiting window is granular (e.g. minutes), this can be tolerated. If your rate limiting config includes larger windows, we recommend setting up [recurrent RDB backups](https://valkey.io/topics/persistence/) (point-in-time snapshots) for better durability guarantees.
