# TensorZero Configuration
nameOverride: ""
fullnameOverride: ""

# Monitoring configurations
monitoring:
  # Configurations for metrics scraping via Prometheus
  metrics:
    # Enable creation of ServiceMonitor for the TensorZero gateway. Requires
    # Prometheus Operator to already exist on your cluster.
    enabled: false
    # The desired scrape interval for the ServiceMonitor.
    interval: "30s"
    # Additional label key-values to attach to the created ServiceMonitor.
    labels: {}

# Gateway Configuration
gateway:
  # Annotations to add to the gateway deployment
  annotations: {}
  replicaCount: 1
  command: [ "gateway" ]
  args:
    # Update this to the correct path if you are using a secret for the configuration
    - --config-file=/app/config/tensorzero.toml
  # Optional service account name for the gateway deployment
  serviceAccountName: "" # @schema description: The service account name for the gateway deployment.

  image:
    repository: tensorzero/gateway
    tag: "" # @schema description: The tag of the gateway image. If empty, uses Chart.appVersion
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 3000

  additionalEnv:
    secretName: "tensorzero-secret"
    keys:
      - name: TENSORZERO_CLICKHOUSE_URL
        key: TENSORZERO_CLICKHOUSE_URL
      - name: TENSORZERO_GATEWAY_URL
        key: TENSORZERO_GATEWAY_URL
      - name: OPENAI_API_KEY
        key: OPENAI_API_KEY
      # TODO: include other model provider credentials as needed

  resources:
    limits:
      cpu: 2000m
      memory: 4096Mi
    requests:
      cpu: 2000m
      memory: 4096Mi

  # Needed for persistence + filesystem object storage (writes a test file at startup) since the image runs as non-root.
  securityContext:
    fsGroup: 2000
    # runAsNonRoot: true
    # runAsUser: 2000
    # runAsGroup: 2000

  nodeSelector: {}

  tolerations: []

  affinity: {}
  ingress:
    enabled: true
    className: ""
    annotations: {}
      # kubernetes.io/tls-acme: "true"
      # cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - host: tensorzero-gateway.local # TODO: change this to the correct host
        paths:
          - path: /
            pathType: Prefix
    tls: []
    #  - secretName: tensorzero-gateway-tls
    #    hosts:
    #      - tensorzero-gateway.local

# UI Configuration
ui:
  deploy: true # TODO: change this to false if you don't want to deploy the UI
  replicaCount: 1

  # Optional service account name for the UI deployment
  serviceAccountName: ""

  image:
    repository: tensorzero/ui
    tag: "" # If empty, uses Chart.appVersion
    pullPolicy: IfNotPresent
    pullSecret: "" # Optional pull secret for private registries

  service:
    type: ClusterIP
    port: 4000

  additionalEnv:
    secretName: "tensorzero-secret"
    keys:
      - name: TENSORZERO_CLICKHOUSE_URL
        key: TENSORZERO_CLICKHOUSE_URL
      - name: TENSORZERO_GATEWAY_URL
        key: TENSORZERO_GATEWAY_URL

  resources:
    limits:
      cpu: 1000m
      memory: 1024Mi
    requests:
      cpu: 500m
      memory: 512Mi

  securityContext:
    fsGroup: 2000
    # runAsNonRoot: true
    # runAsUser: 2000
    # runAsGroup: 2000

  nodeSelector: {}

  tolerations: []

  affinity: {}

  ingress:
    enabled: true
    className: ""
    annotations: {}
      # kubernetes.io/tls-acme: "true"
      # cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - host: tensorzero-ui.local # TODO: change this to the correct host
        paths:
          - path: /
            pathType: Prefix
    tls: []
    #  - secretName: tensorzero-ui-tls
    #    hosts:
    #      - tensorzero-ui.local

# Persistence Configuration
persistence:
  enabled: false
  size: 10Gi
  accessModes:
    - ReadWriteOnce
  storageClass: ""
  mountPath: /app/storage

globalLabels: {}
  # my.domain/owner: my-team

# TensorZero Configuration
configMap:
  data:
    tensorzero.toml: |
      [functions.my_function_name]
      type = "chat"

      [functions.my_function_name.variants.my_variant_name]
      type = "chat_completion"
      model = "openai::gpt-4o-mini"

      # [object_storage]
      # type = "filesystem"
      # path = "/app/storage/"

# If enabled, the configuration will be mounted from this secret instead of the configmap
#  Secret must have a key called "tensorzero.toml" containing the configuration
configFromExternalSecret:
  enabled: false
  secretName: "tensorzero-secret"
  mountPath: /app/config-secret/
# Pass extra Kubernetes objects (e.g., create Secrets with SealedSecrets, ExternalSecrets, etc.).
extraObjects: []
